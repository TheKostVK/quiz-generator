import{a as D,H as P,B}from"./storage-DKKyWHGa.js";class V{#e=null;#n=1;#t=new Map;#s="answer";constructor(t){if(!t||!Array.isArray(t.questions))throw new Error("Quiz: invalid quizData");this.#e=t,this.#o()}#o(){this.#e&&(this.#t=new Map,this.#e.questions.forEach(t=>{this.#t.set(t.id,{questionId:t.id,stage:"idle",correct:null,selectedOptionIds:[]})}),this.#n=1,this.#s="answer")}questionsCount(){return this.#e?this.#e.questions.length:0}getMode(){return this.#s}getCurrentQuestion(){if(!this.#e)return null;const t=this.#n-1,e=this.#e.questions[t];return e?{question:e,questionNumber:this.#n}:null}nextQuestion(){if(!this.#e)return null;const t=this.#n+1;return t>this.#e.questions.length?null:(this.#n=t,this.#s="answer",this.getCurrentQuestion())}isLastQuestion(){return this.#e?this.#n>=this.#e.questions.length:!0}answerQuestion(t,e){if(!this.#e)throw new Error("Quiz: quiz is not loaded");const i=this.#e.questions.find(u=>u.id===t);if(!i)throw new Error(`Quiz: question ${t} not found`);const o=Array.isArray(e)?e:[],n=new Set(o),m=i.options.filter(u=>u.correct).map(u=>u.id),a=new Set(m),c=n.size===a.size&&[...n].every(u=>a.has(u)),d=new Set(n);c||a.forEach(u=>d.add(u));const q=new Set([...n,...a]),l=[...d],f=[...q],_=i.options.map(u=>({...u,selected:d.has(u.id)})),w=this.#t.get(t);return w?(w.stage="answered",w.correct=c,w.selectedOptionIds=[...n]):this.#t.set(t,{questionId:t,stage:"answered",correct:c,selectedOptionIds:[...n]}),this.#s="review",{correct:c,checkedOptionIds:l,highlightOptionIds:f,optionsView:_}}getQuizResult(){if(!this.#e)return null;const t=this.#e.questions.length;let e=0;this.#t.forEach(n=>{n.correct===!0&&(e+=1)});const i=t===0?0:Math.round(e/t*100);let o="bad";return i===100?o="complete":i>=51&&(o="good"),{correctCount:e,total:t,percent:i,status:o}}reset(){this.#n=1,this.#s="answer",this.#t.clear()}}class S{static getState(){const t=new URLSearchParams(window.location.search),e=t.get("id"),i=Number(t.get("question")||1);return{quizId:e,question:i}}static setQuestion(t){const e=new URL(window.location.href);e.searchParams.set("question",String(t)),history.pushState({},"",e)}}class Z{#e;#n=null;#t=null;#s=null;#o=null;#i=null;id=null;inputType="radio";name="";text="";correct=!1;message="";locked=!1;status="neutral";constructor(){const t=document.getElementById("quiz_option");if(!t)throw new Error("QuizOptionCard: template #quiz_option not found");this.#e=t}create(t){const{optionId:e,inputType:i,name:o,text:n,correct:m=!1,message:a=""}=t;if(e==null)throw new Error("QuizOptionCard: optionId is required");if(i!=="radio"&&i!=="checkbox")throw new Error("QuizOptionCard: inputType invalid");if(!o)throw new Error("QuizOptionCard: name is required");if(!n)throw new Error("QuizOptionCard: text is required");this.id=e,this.inputType=i,this.name=o,this.text=n,this.correct=!!m,this.message=a;const c=this.#e.content.cloneNode(!0),d=c.querySelector(".quiz__option"),q=c.querySelector(".choice"),l=c.querySelector(".choice__input"),f=c.querySelector(".choice__label"),_=c.querySelector(".choice__hint");if(!d||!q||!l||!f)throw new Error("QuizOptionCard: template structure is invalid");return this.#n=d,this.#t=q,this.#s=l,this.#o=f,this.#i=_,this.inputType==="radio"?(q.classList.add("choice--radio"),l.type="radio"):(q.classList.remove("choice--radio"),l.type="checkbox"),l.name=this.name,l.value=String(this.id),f.textContent=this.text,this.#i&&(this.message?(this.#i.textContent=this.message,this.#i.hidden=!0):(this.#i.remove(),this.#i=null)),this.clearStatus(),this.unlock(),d}lock(){if(!this.#t||!this.#s)throw new Error("QuizOptionCard: node not created");this.locked=!0,this.#t.setAttribute("disabled",this.locked),this.#t.setAttribute("aria-disabled","true"),this.#t.style.pointerEvents="none",this.#s.disabled=!0,this.#s.tabIndex=-1}unlock(){if(!this.#t||!this.#s)throw new Error("QuizOptionCard: node not created");this.locked=!1,this.#t.classList.remove("choice--locked"),this.#t.removeAttribute("aria-disabled"),this.#t.style.pointerEvents="",this.#s.tabIndex=0}showCorrectness(t={}){const{showHint:e=!0}=t;if(!this.#t)throw new Error("QuizOptionCard: node not created");this.correct?this.setStatus("success"):this.setStatus("error"),e&&this.#i&&(this.#i.hidden=!1)}setStatus(t){if(!this.#t)throw new Error("QuizOptionCard: node not created");this.status=t,this.#t.classList.remove("choice--success","choice--error"),t==="success"&&this.#t.classList.add("choice--success"),t==="error"&&this.#t.classList.add("choice--error");const e=document.createElement("span");e.classList.add("choice__hint","caption"),e.textContent=this.message,this.#n.appendChild(e)}clearStatus(){this.#t&&(this.status="neutral",this.#t.classList.remove("choice--success","choice--error"),this.#i&&(this.#i.hidden=!0,this.#i.textContent=this.message))}getState(){return{id:this.id,name:this.name,inputType:this.inputType,text:this.text,correct:this.correct,message:this.message,checked:this.#s?this.#s.checked:!1,locked:this.locked,status:this.status}}}const C=document.querySelector(".quiz");if(!C)throw new Error("quiz.js: .quiz not found");const H=C.querySelector(".quiz__header"),O=H?.querySelector(".quiz__title"),I=H?.querySelector(".quiz__subtitle"),k=C.querySelector(".quiz__progress"),T=k?.querySelector(".quiz__progress-current"),M=k?.querySelector(".quiz__progress-total"),E=k?.querySelector(".quiz__progress-bar"),N=E?.querySelector(".quiz__progress-fill"),G=C.querySelector(".quiz__question"),$=G?.querySelector(".quiz__question-header"),A=$?.querySelector(".quiz__question-title"),R=$?.querySelector(".quiz__question-subtitle"),p=document.forms.quiz;if(!p)throw new Error('quiz.js: form name="quiz" not found');const v=p.querySelector(".quiz__options");if(!v)throw new Error("quiz.js: .quiz__options not found");const z=p.querySelector(".quiz__submit");if(!z)throw new Error("quiz.js: .quiz__submit not found");const h=document.querySelector(".modal");if(!h)throw new Error("quiz.js: .modal not found");const y=h.querySelector(".modal__title"),x=h.querySelector(".modal__subtitle"),Q=h.querySelector(".body__description"),J=h.querySelector(".modal__close-btn"),K=h.querySelector(".modal__restart-btn"),b=document.createDocumentFragment();let g=[];const{quizId:j,question:W}=S.getState();if(!j)throw new Error("quiz.js: quizId missing in URL");const L=await D(j);if(!L)throw new Error("quiz.js: quiz not found in IndexedDB");const X=new P;X.setMenuItems([{text:"ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ ÐºÐ²Ð¸Ð·Ñ‹",href:`${B}quizzes.html`,variant:"secondary"}]);const r=new V(L),Y=(s,t,e)=>{if(!T||!M||!N)return;const i=Math.max(1,e),o=Math.min(Math.max(t,1),i),n=o/i*100;T.textContent=String(o),M.textContent=String(i),N.style.width=`${n}%`,s.setAttribute("aria-valuenow",String(o)),s.setAttribute("aria-valuemax",String(i))},tt=s=>{const t=r.questionsCount(),e=Math.min(Math.max(Number(s||1),1),Math.max(1,t));for(let i=1;i<e;i++)r.nextQuestion();S.setQuestion(e)},et=()=>{const s=new FormData(p);return Array.from(s.values()).map(t=>Number(t)).filter(t=>Number.isFinite(t))},F=()=>{g=[],b.replaceChildren(),v.replaceChildren();const s=r.getCurrentQuestion();if(!s)throw new Error("quiz.js: current question not found");const{question:t,questionNumber:e}=s,i=t.type==="single"?"radio":"checkbox",o=`question-${t.id}`;A&&(A.textContent=t.text),R&&(R.textContent=i==="radio"?"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð´Ð¸Ð½ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°":"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ð°"),z.textContent="ÐžÑ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ",t.options.forEach(n=>{const m=new Z,a=m.create({optionId:n.id,inputType:i,name:o,text:n.text,correct:n.correct,message:n.message});g.push(m),b.appendChild(a)}),v.appendChild(b),E&&Y(E,e,r.questionsCount())},st=s=>{const t=new Set(s);g.forEach(e=>{s.includes(Number(e.id))||e.lock()}),g.forEach(e=>{const i=e.getState();t.has(Number(i.id))?e.showCorrectness({showHint:!0}):e.clearStatus()}),r.isLastQuestion()?z.textContent="Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚":z.textContent="Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ"},it=()=>{const s=r.getQuizResult();if(s){switch(s.status){case"complete":{y.textContent="Ð¢ÐµÑÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½!",x.textContent="Ð’Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð° Ð²ÑÐµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ ðŸŽ‰",Q.textContent="Ð’Ð°ÑˆÐ¸ Ð·Ð½Ð°Ð½Ð¸Ñ Ð² ÑÑ‚Ð¾Ð¹ Ñ‚ÐµÐ¼Ðµ Ð½Ð° Ð²Ñ‹ÑÐ¾Ñ‚Ðµ!";break}case"good":{y.textContent="Ð¢ÐµÑÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½!",x.textContent=`Ð’Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð° ${s.correctCount} Ð¸Ð· ${s.total} Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð²`,Q.textContent="ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð°Ñ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ°! Ð’Ñ‹ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð½Ð° Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ñ‚ÐµÑÑ‚Ð°, Ð½Ð¾ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ‚ÐµÐ¼Ñ‹ ÑÑ‚Ð¾Ð¸Ñ‚ Ð¾ÑÐ²ÐµÐ¶Ð¸Ñ‚ÑŒ. ÐŸÑ€Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ñ‚ÐµÑÑ‚ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð·Ð½Ð°Ð½Ð¸Ñ.";break}case"bad":{y.textContent="ÐÐµ Ñ€Ð°ÑÑÑ‚Ñ€Ð°Ð¸Ð²Ð°Ð¹Ñ‚ÐµÑÑŒ!",x.textContent=`Ð’Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ð»Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð½Ð° ${s.correctCount} Ð¸Ð· ${s.total} Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð²`,Q.textContent="ÐÐµ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°Ð¹Ñ‚Ðµ â€” Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÑÑ‚Ð¾ Ñ‡Ð°ÑÑ‚ÑŒ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾Ð¹Ñ‚Ð¸ Ñ‚ÐµÑÑ‚ ÑÐ½Ð¾Ð²Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚.";break}}h.classList.add("modal--open"),console.log("QUIZ RESULT",s)}},U=()=>{const{title:s,description:t}=L;O&&(O.textContent=s),I&&(I.textContent=t),F()},nt=s=>{if(s.preventDefault(),r.getMode()==="answer"){const t=r.getCurrentQuestion();if(!t)return;const e=t.question,i=et();if(i.length===0){console.warn("Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°");return}const o=r.answerQuestion(e.id,i);st(o.highlightOptionIds);return}if(r.getMode()==="review"){if(r.isLastQuestion()){it();return}const t=r.nextQuestion();if(!t)return;S.setQuestion(t.questionNumber),F()}},ot=()=>{window.location.href=`${B}quizzes.html`},rt=s=>{s.preventDefault(),r.reset(),S.setQuestion(1),U(),h.classList.remove("modal--open")};tt(W);U();p.addEventListener("submit",nt);K.addEventListener("click",rt);J.addEventListener("click",ot);
